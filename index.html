<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.1.0/reset.min.css"
      integrity="sha512-Mjxkx+r7O/OLQeKeIBCQ2yspG1P5muhAtv/J+p2/aPnSenciZWm5Wlnt+NOUNA4SHbnBIE/R2ic0ZBiCXdQNUg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://obniz.io/js/jquery-3.2.1.min.js"></script>
    <script
      src="https://unpkg.com/obniz@3.7.0/obniz.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://fonts.googleapis.com/css?family=Poppins"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/default.min.css"
    />
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>

    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <div id="main-container">
      <div class="input-container select-pdf-container">
        <div class="input-container-title">Upload Your PDF File</div>
        <div id="pdf-file-name" class="file-name"></div>
        <div class="drag-drop-area" id="drag-drop-pdf">
          <div id="pdf-icon">
            <img
              src="src/assets/pdf-file-outlined-interface-symbol_icon-icons.com_57528.svg"
              width="80px"
              height="80px"
            />
          </div>
          <div class="drag-drop-text">Drag & Drop</div>
        </div>
        <div
          style="
            margin-top: 18px;
            font-family: 'Poppins sans-serif';
            color: #8d8888;
          "
        >
          Or
        </div>
        <input id="input-pdf" type="file" accept="application/pdf" />
        <div>
          <label
            for="input-pdf"
            class="select-file-button pure-material-button-contained"
          >
            Select a File
          </label>
        </div>
      </div>
      <div class="input-container select-pdf-container">
        <div class="input-container-title">Upload Your Script File</div>
        <div id="script-file-name" class="file-name"></div>
        <div class="drag-drop-area" id="drag-drop-script">
          <div id="script-icon">
            <img src="src/assets/js.svg" width="80px" height="80px" />
          </div>
          <div class="drag-drop-text">Drag & Drop</div>
        </div>
        <div
          style="
            margin-top: 18px;
            font-family: 'Poppins sans-serif';
            color: #8d8888;
          "
        >
          Or
        </div>
        <div>
          <label
            for="input-script"
            class="select-file-button pure-material-button-contained"
          >
            Select a File
          </label>
        </div>

        <input id="input-script" type="file" accept=".js" />
      </div>
      <div class="input-container select-pdf-container">
        <div class="input-container-title">Upload Your CSV File</div>
        <div id="csv-file-name" class="file-name"></div>
        <div class="drag-drop-area" id="drag-drop-csv">
          <div id="csv-icon">
            <img
              src="src/assets/pdf-file-outlined-interface-symbol_icon-icons.com_57528.svg"
              width="80px"
              height="80px"
            />
          </div>
          <div class="drag-drop-text">Drag & Drop</div>
        </div>
        <div
          style="
            margin-top: 18px;
            font-family: 'Poppins sans-serif';
            color: #8d8888;
          "
        >
          Or
        </div>
        <input id="input-csv" type="file" accept=".csv" />
        <div>
          <label
            for="input-csv"
            class="select-file-button pure-material-button-contained"
          >
            Select a File
          </label>
        </div>
      </div>
    </div>
    <div id="start-presentation-container">
      <button
        id="start-presentation-button"
        class="pure-material-button-contained unable-button"
      >
        Start Presentation
      </button>
    </div>
    <div id="preview-cover"></div>
    <div id="preview-container">
      <div id="preview-current-slide-container">
        <div id="preview-curernt-slide">
          <img
            id="slide-img"
            src="src/assets/スクリーンショット 2021-07-06 6.36.19.png"
          />
        </div>
        <div id="preview-current-slide-controller">
          <div class="controller-button" id="controller-back">
            <img src="src/assets/outline_navigate_before_black_48dp.png" />
          </div>
          <div id="controller-text">
            スライド<span id="controller-slide-num"></span>
          </div>
          <div class="controller-button" id="controller-next">
            <img src="src/assets/outline_navigate_next_black_48dp.png" />
          </div>
        </div>
      </div>
      <div id="preview-current-code-contaienr">
        <pre>
          <code id="code">
          </code>
        </pre>
      </div>
    </div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.8.335/pdf.min.js"
      integrity="sha512-SG4yH2eYtAR5eK4/VL0bhqOsIb6AZSWAJjHOCmfhcaqTkDviJFoar/VYdG96iY7ouGhKQpAg3CMJ22BrZvhOUA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="src/convertPdfToImage.js"></script>
    <script src="src/dragAndDrop.js"></script>
    <script src="src/main.js"></script>
    <script src="src/loadScript.js"></script>

    <script>
      hljs.initHighlightingOnLoad();
      hljs.initLineNumbersOnLoad();
      const startButton = document.getElementById('start-presentation-button');
      const cover = document.getElementById('preview-cover');
      const preview = document.getElementById('preview-container');
      cover.addEventListener('click', (e) => {
        e.target.style.display = 'none';
        preview.style.display = 'none';
      });
      startButton.addEventListener('click', async () => {
        const scriptUrl = await getFileUrl(scriptInput.files[0]);
        const pdfUrl = await getFileUrl(pdfInput.files[0]);
        loadSlideScript(scriptUrl);
        getAllImageUrl(pdfUrl).then((images) => {
          let currentSlideState = 1;
          const controllerSlideNum = document.getElementById(
            'controller-slide-num'
          );
          controllerSlideNum.innerHTML = `${currentSlideState} / ${images.length}`;

          const slideImage = document.getElementById('slide-img');
          slideImage.src = images[currentSlideState - 1];

          const code = document.getElementById('code');
          code.innerHTML = slideFunctions[currentSlideState - 1];

          const backButton = document.getElementById('controller-back');
          const nextButton = document.getElementById('controller-next');
          backButton.addEventListener('click', () => {
            if (currentSlideState > 1) {
              currentSlideState--;
              controllerSlideNum.innerHTML = `${currentSlideState} / ${images.length}`;
              slideImage.src = images[currentSlideState - 1];
              code.innerHTML = slideFunctions[currentSlideState - 1];
            }
          });
          nextButton.addEventListener('click', () => {
            if (currentSlideState < images.length) {
              currentSlideState++;
              controllerSlideNum.innerHTML = `${currentSlideState} / ${images.length}`;
              slideImage.src = images[currentSlideState - 1];
              code.innerHTML = slideFunctions[currentSlideState - 1];
            }
          });
        });
        cover.style.display = 'block';
        preview.style.display = 'flex';
      });
    </script>
  </body>
</html>
